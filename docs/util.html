<!DOCTYPE html>  <html> <head>   <title>util.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="events.html">                 events.js               </a>                                           <a class="source" href="filters.html">                 filters.js               </a>                                           <a class="source" href="header.html">                 header.js               </a>                                           <a class="source" href="io.html">                 io.js               </a>                                           <a class="source" href="layers.html">                 layers.js               </a>                                           <a class="source" href="loader.html">                 loader.js               </a>                                           <a class="source" href="pixelInfo.html">                 pixelInfo.js               </a>                                           <a class="source" href="render.html">                 render.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               util.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Utility functions that help out in various areas of CamanJS.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global Caman: true */</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Caman</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Shortcuts</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">forEach</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">,</span>
<span class="nx">hasOwn</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">,</span>
<span class="nx">slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span>

<span class="nx">Caman</span><span class="p">.</span><span class="nx">plugin</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Function.prototype.bind polyfill</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="p">)</span> <span class="p">{</span>

  <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">slice</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">,</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> 
        <span class="nx">nop</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span> 
        <span class="nx">bound</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span> <span class="k">instanceof</span> <span class="nx">nop</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="p">(</span> <span class="nx">obj</span> <span class="o">||</span> <span class="p">{}</span> <span class="p">),</span> 
                              <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span>    
        <span class="p">};</span>

    <span class="nx">nop</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>

    <span class="nx">bound</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nop</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">bound</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>When Caman is output as a string, we can output some pretty version and release info data
instead of throwing an error or something boring.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="s2">&quot;Version &quot;</span> <span class="o">+</span> <span class="nx">Caman</span><span class="p">.</span><span class="nx">version</span><span class="p">.</span><span class="nx">release</span> <span class="o">+</span> <span class="s2">&quot;, Released &quot;</span> <span class="o">+</span> <span class="nx">Caman</span><span class="p">.</span><span class="nx">version</span><span class="p">.</span><span class="nx">date</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Utility forEach function for iterating over objects/arrays. If the browser has native forEach,
then it will use that instead.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span> <span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">obj</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{};</span>
  <span class="p">}</span>
  
  <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Use native whenever possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span> <span class="nx">forEach</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">===</span> <span class="nx">forEach</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
  <span class="p">}</span> 

  <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
    <span class="p">}</span> 
  <span class="p">}</span>        

  <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Used for extending the object, primarily the Caman object add new functionality to the base library.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">dest</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">src</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="nx">Caman</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">src</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">copy</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">copy</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">copy</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">dest</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">copy</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
  
  <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>      
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Clamps an RGB value between 0 and 255. This is necessary
to run on all updated pixel values in order to conform to
the spec (which says that values &lt; 0 or > 255 will be modulo'd
instead of clamped.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">clampRGB</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">return</span> <span class="mi">255</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Here we define the proxies that ship with CamanJS for easy usage.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">useProxy</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Define cases where file extensions don't match the language name</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">langToExt</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">ruby</span><span class="o">:</span> <span class="s1">&#39;rb&#39;</span><span class="p">,</span>
    <span class="nx">python</span><span class="o">:</span> <span class="s1">&#39;py&#39;</span><span class="p">,</span>
    <span class="nx">perl</span><span class="o">:</span> <span class="s1">&#39;pl&#39;</span>
  <span class="p">};</span>
  
  <span class="nx">lang</span> <span class="o">=</span> <span class="nx">langToExt</span><span class="p">[</span><span class="nx">lang</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()]</span> <span class="o">||</span> <span class="nx">lang</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
  
  <span class="k">return</span> <span class="s2">&quot;proxies/caman_proxy.&quot;</span> <span class="o">+</span> <span class="nx">lang</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Unique ID generator. Guaranteed to always generate a new ID.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">uniqid</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This ID value is incremented every time get() is called, and can still be accessed
by get() at all times because it is included in get()'s closure.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">id</span><span class="o">++</span><span class="p">;</span>
    <span class="p">},</span>
    
    <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}());</span>

<span class="nx">Caman</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Caman</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Returns the size of an object (the number of properties the object has)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">sizeOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">prop</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="p">(</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">obj</span>  <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">size</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
            
    <span class="k">return</span> <span class="nx">size</span><span class="p">;</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Determines whether two given objects are the same based on their properties and values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">sameAs</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">test</span> <span class="p">)</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>only tests arrays
TODO: extend to object tests</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span> <span class="nx">base</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">test</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span> <span class="p">)</span>  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">base</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">test</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Removes items with the given value from an array if they are present.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">arr</span><span class="p">,</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">item</span>  <span class="p">)</span> <span class="p">{</span>
        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>      
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Generates a pseudorandom number that lies within the max - mix range. The number can be either
an integer or a float depending on what the user specifies.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">randomRange</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">,</span> <span class="kr">float</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rand</span> <span class="o">=</span> <span class="nx">min</span> <span class="o">+</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">));</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="kr">float</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">?</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">rand</span><span class="p">)</span> <span class="o">:</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="kr">float</span><span class="p">);</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Converts an RGB color to HSL.
Assumes r, g, and b are in the set [0, 255] and
returns h, s, and l in the set [0, 1].</p>

<pre>
@param   Number  r   Red channel
@param   Number  g   Green channel
@param   Number  b   Blue channel
@return              The HSL representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">rgb_to_hsl</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  
    <span class="nx">r</span> <span class="o">/=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="nx">g</span> <span class="o">/=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">/=</span> <span class="mi">255</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">min</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> 
        <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">+</span> <span class="nx">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">max</span> <span class="o">==</span> <span class="nx">min</span><span class="p">){</span>
        <span class="nx">h</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// achromatic</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">;</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">l</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">?</span> <span class="nx">d</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">)</span> <span class="o">:</span> <span class="nx">d</span> <span class="o">/</span> <span class="p">(</span><span class="nx">max</span> <span class="o">+</span> <span class="nx">min</span><span class="p">);</span>
        <span class="k">switch</span><span class="p">(</span><span class="nx">max</span><span class="p">){</span>
            <span class="k">case</span> <span class="nx">r</span><span class="o">:</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">g</span> <span class="o">-</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="mi">6</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">r</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">r</span> <span class="o">-</span> <span class="nx">g</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">h</span> <span class="o">/=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="nx">h</span><span class="o">:</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="o">:</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">l</span><span class="o">:</span> <span class="nx">l</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Converts from the hue color space back to RGB.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hue_to_rgb</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">t</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">t</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="k">return</span> <span class="nx">p</span> <span class="o">+</span> <span class="p">(</span><span class="nx">q</span> <span class="o">-</span> <span class="nx">p</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">*</span> <span class="nx">t</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nx">q</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="nx">p</span> <span class="o">+</span> <span class="p">(</span><span class="nx">q</span> <span class="o">-</span> <span class="nx">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="nx">t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">;</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Converts an HSL color value to RGB. Conversion formula
adapted from http://en.wikipedia.org/wiki/HSL<em>color</em>space.
Assumes h, s, and l are contained in the set [0, 1] and
returns r, g, and b in the set [0, 255].</p>

<pre>
@param   Number  h       The hue
@param   Number  s       The saturation
@param   Number  l       The lightness
@return  Array           The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hsl_to_rgb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">l</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">;</span>
  
      <span class="k">if</span><span class="p">(</span><span class="nx">s</span> <span class="o">===</span> <span class="mi">0</span><span class="p">){</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span> <span class="c1">// achromatic</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">l</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="o">?</span> <span class="nx">l</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">s</span><span class="p">)</span> <span class="o">:</span> <span class="nx">l</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">-</span> <span class="nx">l</span> <span class="o">*</span> <span class="nx">s</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">l</span> <span class="o">-</span> <span class="nx">q</span><span class="p">;</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hue_to_rgb</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">h</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span>
          <span class="nx">g</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hue_to_rgb</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
          <span class="nx">b</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hue_to_rgb</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="p">{</span><span class="nx">r</span><span class="o">:</span> <span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Converts an RGB color value to HSV. Conversion formula
adapted from http://en.wikipedia.org/wiki/HSV<em>color</em>space.
Assumes r, g, and b are contained in the set [0, 255] and
returns h, s, and v in the set [0, 1].</p>

<pre>
@param   Number  r       The red color value
@param   Number  g       The green color value
@param   Number  b       The blue color value
@return  Array           The HSV representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">rgb_to_hsv</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">){</span>
      
      <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
      <span class="nx">g</span> <span class="o">=</span> <span class="nx">g</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
      
      <span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">min</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span>
          <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">max</span><span class="p">,</span>
          <span class="nx">d</span> <span class="o">=</span> <span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">;</span>
          
      <span class="nx">s</span> <span class="o">=</span> <span class="nx">max</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">d</span> <span class="o">/</span> <span class="nx">max</span><span class="p">;</span>
  
      <span class="k">if</span><span class="p">(</span><span class="nx">max</span> <span class="o">==</span> <span class="nx">min</span><span class="p">){</span>
          <span class="nx">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// achromatic</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">switch</span><span class="p">(</span><span class="nx">max</span><span class="p">){</span>
              <span class="k">case</span> <span class="nx">r</span><span class="o">:</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">g</span> <span class="o">-</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="mi">6</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">r</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">r</span> <span class="o">-</span> <span class="nx">g</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">h</span> <span class="o">/=</span> <span class="mi">6</span><span class="p">;</span>
      <span class="p">}</span>
  
      <span class="k">return</span> <span class="p">{</span><span class="nx">h</span><span class="o">:</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="o">:</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="o">:</span> <span class="nx">v</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Converts an HSV color value to RGB. Conversion formula
adapted from http://en.wikipedia.org/wiki/HSV<em>color</em>space.
Assumes h, s, and v are contained in the set [0, 1] and
returns r, g, and b in the set [0, 255].</p>

<pre>
@param   Number  h       The hue
@param   Number  s       The saturation
@param   Number  v       The value
@return  Array           The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hsv_to_rgb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span>
    
      <span class="kd">var</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span>
          <span class="nx">i</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">),</span>
          <span class="nx">f</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="nx">i</span><span class="p">,</span>
          <span class="nx">p</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span><span class="p">),</span>
          <span class="nx">q</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span> <span class="o">*</span> <span class="nx">s</span><span class="p">),</span>
          <span class="nx">t</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span><span class="p">)</span> <span class="o">*</span> <span class="nx">s</span><span class="p">);</span>
  
      <span class="k">switch</span><span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">6</span><span class="p">){</span>
          <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> 
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="nx">g</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">q</span><span class="p">;</span>
            <span class="nx">g</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="nx">g</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="nx">g</span> <span class="o">=</span> <span class="nx">q</span><span class="p">;</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
            <span class="nx">g</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="nx">g</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">q</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
  
      <span class="k">return</span> <span class="p">{</span><span class="nx">r</span><span class="o">:</span> <span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Converts a RGB color value to the XYZ color space. Formulas
are based on http://en.wikipedia.org/wiki/SRGB assuming that
RGB values are sRGB.</p>

<p>Assumes r, g, and b are contained in the set [0, 255] and
returns x, y, and z.</p>

<pre>
@param   Number  r       The red color value
@param   Number  g       The green color value
@param   Number  b       The blue color value
@return  Array           The XYZ representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">rgb_to_xyz</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  
    <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">/</span> <span class="mi">255</span><span class="p">;</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">g</span> <span class="o">/</span> <span class="mi">255</span><span class="p">;</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">/</span> <span class="mi">255</span><span class="p">;</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">r</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">g</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">g</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">g</span> <span class="o">=</span> <span class="nx">g</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">b</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">*</span> <span class="mf">0.4124</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">*</span> <span class="mf">0.3576</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">*</span> <span class="mf">0.1805</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">*</span> <span class="mf">0.2126</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">*</span> <span class="mf">0.7152</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">*</span> <span class="mf">0.0722</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">*</span> <span class="mf">0.0193</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">*</span> <span class="mf">0.1192</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">*</span> <span class="mf">0.9505</span><span class="p">;</span>
  
    <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="nx">z</span> <span class="o">*</span> <span class="mi">100</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Converts a XYZ color value to the sRGB color space. Formulas
are based on http://en.wikipedia.org/wiki/SRGB and the resulting
RGB value will be in the sRGB color space.
Assumes x, y and z values are whatever they are and returns
r, g and b in the set [0, 255].</p>

<pre>
@param   Number  x       The X value
@param   Number  y       The Y value
@param   Number  z       The Z value
@return  Array           The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">xyz_to_rgb</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">z</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
  
    <span class="kd">var</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">;</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.2406</span>  <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.5372</span> <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.4986</span> <span class="o">*</span> <span class="nx">z</span><span class="p">);</span>
    <span class="nx">g</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.9689</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.8758</span>  <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.0415</span>  <span class="o">*</span> <span class="nx">z</span><span class="p">);</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0557</span>  <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2040</span> <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0570</span>  <span class="o">*</span> <span class="nx">z</span><span class="p">);</span>
  
    <span class="k">if</span><span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.055</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="mf">0.4166666667</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">if</span><span class="p">(</span><span class="nx">g</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">g</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.055</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span> <span class="mf">0.4166666667</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">g</span> <span class="o">=</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="nx">g</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">if</span><span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.055</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mf">0.4166666667</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">return</span> <span class="p">{</span><span class="nx">r</span><span class="o">:</span> <span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Converts a XYZ color value to the CIELAB color space. Formulas
are based on http://en.wikipedia.org/wiki/Lab<em>color</em>space
The reference white point used in the conversion is D65.
Assumes x, y and z values are whatever they are and returns
L<em>, a</em> and b* values</p>

<pre>
@param   Number  x       The X value
@param   Number  y       The Y value
@param   Number  z       The Z value
@return  Array           The Lab representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">xyz_to_lab</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>D65 reference white point</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">whiteX</span> <span class="o">=</span> <span class="mf">95.047</span><span class="p">,</span> <span class="nx">whiteY</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">,</span> <span class="nx">whiteZ</span> <span class="o">=</span> <span class="mf">108.883</span><span class="p">;</span>
  
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">whiteX</span><span class="p">;</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">/</span> <span class="nx">whiteY</span><span class="p">;</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">z</span> <span class="o">/</span> <span class="nx">whiteZ</span><span class="p">;</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mf">0.008856451679</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (6/29) ^ 3</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mf">0.3333333333</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.787037037</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1379310345</span><span class="p">;</span> <span class="c1">// (1/3) * ((29/6) ^ 2)c + (4/29)</span>
    <span class="p">}</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mf">0.008856451679</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="mf">0.3333333333</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.787037037</span> <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1379310345</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">z</span> <span class="o">&gt;</span> <span class="mf">0.008856451679</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">z</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span> <span class="mf">0.3333333333</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">z</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.787037037</span> <span class="o">*</span> <span class="nx">z</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1379310345</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="mi">116</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">-</span> <span class="mi">16</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">y</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">z</span><span class="p">);</span>
  
    <span class="k">return</span> <span class="p">{</span><span class="nx">l</span><span class="o">:</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">a</span><span class="o">:</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">b</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Converts a L<em>, a</em>, b* color values from the CIELAB color space
to the XYZ color space. Formulas are based on
http://en.wikipedia.org/wiki/Lab<em>color</em>space</p>

<p>The reference white point used in the conversion is D65.
Assumes L<em>, a</em> and b* values are whatever they are and returns
x, y and z values.</p>

<pre>
@param   Number  l       The L* value
@param   Number  a       The a* value
@param   Number  b       The b* value
@return  Array           The XYZ representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">lab_to_xyz</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  
    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">l</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">116</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">a</span> <span class="o">/</span> <span class="mi">500</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">b</span> <span class="o">/</span> <span class="mi">200</span><span class="p">);</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mf">0.2068965517</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 6 / 29</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="mf">0.1284185493</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mf">0.1379310345</span><span class="p">);</span> <span class="c1">// 3 * ((6 / 29) ^ 2) * (c - (4 / 29))</span>
    <span class="p">}</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mf">0.2068965517</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="mf">0.1284185493</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="mf">0.1379310345</span><span class="p">);</span>
    <span class="p">}</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">z</span> <span class="o">&gt;</span> <span class="mf">0.2068965517</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">z</span> <span class="o">=</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">z</span> <span class="o">=</span> <span class="mf">0.1284185493</span> <span class="o">*</span> <span class="p">(</span><span class="nx">z</span> <span class="o">-</span> <span class="mf">0.1379310345</span><span class="p">);</span>
    <span class="p">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>D65 reference white point</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="mf">95.047</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="nx">z</span> <span class="o">*</span> <span class="mf">108.883</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Converts the hex representation of a color to RGB values.
Hex value can optionally start with the hash (#).</p>

<pre>
@param   String  hex   The colors hex value
@return  Array         The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hex_to_rgb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hex</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">hex</span> <span class="o">=</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">r</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
    <span class="nx">g</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="nx">r</span><span class="o">:</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">b</span><span class="p">};</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Generates a bezier curve given a start and end point, with two control points in between.
Can also optionally bound the y values between a low and high bound.</p>

<p>This is different than most bezier curve functions because it attempts to construct it in such 
a way that we can use it more like a simple input -> output system, or a one-to-one function. 
In other words we can provide an input color value, and immediately receive an output modified color value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">bezier</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">ctrl1</span><span class="p">,</span> <span class="nx">ctrl2</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">lowBound</span><span class="p">,</span> <span class="nx">highBound</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">Ax</span><span class="p">,</span> <span class="nx">Bx</span><span class="p">,</span> <span class="nx">Cx</span><span class="p">,</span> <span class="nx">Ay</span><span class="p">,</span> <span class="nx">By</span><span class="p">,</span> <span class="nx">Cy</span><span class="p">,</span>
    <span class="nx">x0</span> <span class="o">=</span> <span class="nx">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">y0</span> <span class="o">=</span> <span class="nx">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">x1</span> <span class="o">=</span> <span class="nx">ctrl1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">y1</span> <span class="o">=</span> <span class="nx">ctrl1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">x2</span> <span class="o">=</span> <span class="nx">ctrl2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">y2</span> <span class="o">=</span> <span class="nx">ctrl2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">x3</span> <span class="o">=</span> <span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">y3</span> <span class="o">=</span> <span class="nx">end</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">t</span><span class="p">,</span> <span class="nx">curveX</span><span class="p">,</span> <span class="nx">curveY</span><span class="p">,</span>
    <span class="nx">bezier</span> <span class="o">=</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Calculate our X and Y coefficients</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Cx</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x1</span> <span class="o">-</span> <span class="nx">x0</span><span class="p">);</span>
    <span class="nx">Bx</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x2</span> <span class="o">-</span> <span class="nx">x1</span><span class="p">)</span> <span class="o">-</span> <span class="nx">Cx</span><span class="p">;</span>
    <span class="nx">Ax</span> <span class="o">=</span> <span class="nx">x3</span> <span class="o">-</span> <span class="nx">x0</span> <span class="o">-</span> <span class="nx">Cx</span> <span class="o">-</span> <span class="nx">Bx</span><span class="p">;</span>
    
    <span class="nx">Cy</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y1</span> <span class="o">-</span> <span class="nx">y0</span><span class="p">);</span>
    <span class="nx">By</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y2</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">)</span> <span class="o">-</span> <span class="nx">Cy</span><span class="p">;</span>
    <span class="nx">Ay</span> <span class="o">=</span> <span class="nx">y3</span> <span class="o">-</span> <span class="nx">y0</span> <span class="o">-</span> <span class="nx">Cy</span> <span class="o">-</span> <span class="nx">By</span><span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>1000 is actually arbitrary. We need to make sure we do enough calculations between 0 and 255 that, in even
the more extreme circumstances, we calculate as many values as possible. In the event that an X value is
skipped, it will be found later on.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">t</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
      </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Calculate our X and Y values for this iteration</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">curveX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">Ax</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Bx</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Cx</span> <span class="o">*</span> <span class="nx">t</span><span class="p">)</span> <span class="o">+</span> <span class="nx">x0</span><span class="p">);</span>
      <span class="nx">curveY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">Ay</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">By</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Cy</span> <span class="o">*</span> <span class="nx">t</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y0</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">lowBound</span> <span class="o">&amp;&amp;</span> <span class="nx">curveY</span> <span class="o">&lt;</span> <span class="nx">lowBound</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">curveY</span> <span class="o">=</span> <span class="nx">lowBound</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">highBound</span> <span class="o">&amp;&amp;</span> <span class="nx">curveY</span> <span class="o">&gt;</span> <span class="nx">highBound</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">curveY</span> <span class="o">=</span> <span class="nx">highBound</span><span class="p">;</span>
      <span class="p">}</span>
      </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Store the calculation</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">bezier</span><span class="p">[</span><span class="nx">curveX</span><span class="p">]</span> <span class="o">=</span> <span class="nx">curveY</span><span class="p">;</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Do a search for missing values in the bezier array and use linear interpolation
to approximate their values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">leftCoord</span><span class="p">,</span> <span class="nx">rightCoord</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">slope</span><span class="p">,</span> <span class="nx">bint</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bezier</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">bezier</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The value to the left will always be defined. We don't have to worry about
when i = 0 because the starting point is guaranteed (I think...)</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">leftCoord</span> <span class="o">=</span> <span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">bezier</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]];</span>
          </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Find the first value to the right that was found. Ideally this loop will break
very quickly.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">bezier</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">rightCoord</span> <span class="o">=</span> <span class="p">[</span><span class="nx">j</span><span class="p">,</span> <span class="nx">bezier</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Store the value discovered with linear interpolation</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">bezier</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">leftCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="nx">rightCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">leftCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="nx">rightCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">leftCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="nx">leftCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Edge case</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">bezier</span><span class="p">[</span><span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bezier</span><span class="p">[</span><span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">bezier</span><span class="p">[</span><span class="mi">254</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">bezier</span><span class="p">;</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Calculate the distance between two points on a cartesian plane.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">distance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">x2</span> <span class="o">-</span> <span class="nx">x1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">y2</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="p">}(</span><span class="nx">Caman</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 