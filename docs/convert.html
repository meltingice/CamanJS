<!DOCTYPE html>  <html> <head>   <title>convert.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="analyze.html">                 analyze.coffee               </a>                                           <a class="source" href="autoload.html">                 autoload.coffee               </a>                                           <a class="source" href="blender.html">                 blender.coffee               </a>                                           <a class="source" href="calculate.html">                 calculate.coffee               </a>                                           <a class="source" href="caman.html">                 caman.coffee               </a>                                           <a class="source" href="camaninstance.html">                 camaninstance.coffee               </a>                                           <a class="source" href="convert.html">                 convert.coffee               </a>                                           <a class="source" href="event.html">                 event.coffee               </a>                                           <a class="source" href="filter.html">                 filter.coffee               </a>                                           <a class="source" href="io.html">                 io.coffee               </a>                                           <a class="source" href="layer.html">                 layer.coffee               </a>                                           <a class="source" href="logger.html">                 logger.coffee               </a>                                           <a class="source" href="pixelinfo.html">                 pixelinfo.coffee               </a>                                           <a class="source" href="plugin.html">                 plugin.coffee               </a>                                           <a class="source" href="renderjob.html">                 renderjob.coffee               </a>                                           <a class="source" href="store.html">                 store.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                                           <a class="source" href="blenders.html">                 blenders.coffee               </a>                                           <a class="source" href="filters.html">                 filters.coffee               </a>                                           <a class="source" href="blur.html">                 blur.coffee               </a>                                           <a class="source" href="camera.html">                 camera.coffee               </a>                                           <a class="source" href="compoundBlur.html">                 compoundBlur.coffee               </a>                                           <a class="source" href="edges.html">                 edges.coffee               </a>                                           <a class="source" href="posterize.html">                 posterize.coffee               </a>                                           <a class="source" href="presets.html">                 presets.coffee               </a>                                           <a class="source" href="size.html">                 size.coffee               </a>                                           <a class="source" href="stackBlur.html">                 stackBlur.coffee               </a>                                           <a class="source" href="threshold.html">                 threshold.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               convert.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Tons of color conversion functions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Convert</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Converts the hex representation of a color to RGB values.
Hex value can optionally start with the hash (#).</p>

<pre>
@param   String  hex   The colors hex value
@return  Array         The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@hexToRGB: </span><span class="nf">(hex) -&gt;</span>
    <span class="nv">hex = </span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span>
    <span class="nv">r = </span><span class="nb">parseInt</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span>
    <span class="nv">g = </span><span class="nb">parseInt</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span>
    <span class="nv">b = </span><span class="nb">parseInt</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span>

    <span class="nv">r: </span><span class="nx">r</span><span class="p">,</span> <span class="nv">g: </span><span class="nx">g</span><span class="p">,</span> <span class="nv">b: </span><span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Converts an RGB color to HSL.
Assumes r, g, and b are in the set [0, 255] and
returns h, s, and l in the set [0, 1].</p>

<pre>
@param   Number  r   Red channel
@param   Number  g   Green channel
@param   Number  b   Blue channel
@return              The HSL representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@rgbToHSL: </span><span class="nf">(r, g, b) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">g = </span><span class="nx">r</span><span class="p">.</span><span class="nx">g</span>
      <span class="nv">b = </span><span class="nx">r</span><span class="p">.</span><span class="nx">b</span>
      <span class="nv">r = </span><span class="nx">r</span><span class="p">.</span><span class="nx">r</span>

    <span class="nx">r</span> <span class="o">/=</span> <span class="mi">255</span>
    <span class="nx">g</span> <span class="o">/=</span> <span class="mi">255</span>
    <span class="nx">b</span> <span class="o">/=</span> <span class="mi">255</span>

    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
    <span class="nv">min = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
    <span class="nv">l = </span><span class="p">(</span><span class="nx">max</span> <span class="o">+</span> <span class="nx">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="nx">min</span>
      <span class="nv">h = s = </span><span class="mi">0</span>
    <span class="k">else</span>
      <span class="nv">d = </span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span>
      <span class="nv">s = </span><span class="k">if</span> <span class="nx">l</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">then</span> <span class="nx">d</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">)</span> <span class="k">else</span> <span class="nx">d</span> <span class="o">/</span> <span class="p">(</span><span class="nx">max</span> <span class="o">+</span> <span class="nx">min</span><span class="p">)</span>
      <span class="nv">h = </span><span class="k">switch</span> <span class="nx">max</span>
        <span class="k">when</span> <span class="nx">r</span> <span class="k">then</span> <span class="p">(</span><span class="nx">g</span> <span class="o">-</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="nx">g</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="k">then</span> <span class="mi">6</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">when</span> <span class="nx">g</span> <span class="k">then</span> <span class="p">(</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">r</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">when</span> <span class="nx">b</span> <span class="k">then</span> <span class="p">(</span><span class="nx">r</span> <span class="o">-</span> <span class="nx">g</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">4</span>
      
      <span class="nx">h</span> <span class="o">/=</span> <span class="mi">6</span>

    <span class="nv">h: </span><span class="nx">h</span><span class="p">,</span> <span class="nv">s: </span><span class="nx">s</span><span class="p">,</span> <span class="nv">l: </span><span class="nx">l</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Converts an HSL color value to RGB. Conversion formula
adapted from http://en.wikipedia.org/wiki/HSL<em>color</em>space.
Assumes h, s, and l are contained in the set [0, 1] and
returns r, g, and b in the set [0, 255].</p>

<pre>
@param   Number  h       The hue
@param   Number  s       The saturation
@param   Number  l       The lightness
@return  Array           The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@hslToRGB: </span><span class="nf">(h, s, l) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">h</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">s = </span><span class="nx">h</span><span class="p">.</span><span class="nx">s</span>
      <span class="nv">l = </span><span class="nx">h</span><span class="p">.</span><span class="nx">l</span>
      <span class="nv">h = </span><span class="nx">h</span><span class="p">.</span><span class="nx">h</span>

    <span class="k">if</span> <span class="nx">s</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nv">r = g = b = </span><span class="nx">l</span>
    <span class="k">else</span>
      <span class="nv">q = </span><span class="k">if</span> <span class="nx">l</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">then</span> <span class="nx">l</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">s</span><span class="p">)</span> <span class="k">else</span> <span class="nx">l</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">-</span> <span class="nx">l</span> <span class="o">*</span> <span class="nx">s</span>
      <span class="nv">p = </span><span class="mi">2</span> <span class="o">*</span> <span class="nx">l</span> <span class="o">-</span> <span class="nx">q</span>
      
      <span class="nv">r = </span><span class="nx">@hueToRGB</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">h</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
      <span class="nv">g = </span><span class="nx">@hueToRGB</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">h</span>
      <span class="nv">b = </span><span class="nx">@hueToRGB</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>

    <span class="nv">r: </span><span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nv">g: </span><span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nv">b: </span><span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Converts from the hue color space back to RGB</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@hueToRGB: </span><span class="nf">(p, q, t) -&gt;</span>
    <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">t</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nx">t</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">t</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">p</span> <span class="o">+</span> <span class="p">(</span><span class="nx">q</span> <span class="o">-</span> <span class="nx">p</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">*</span> <span class="nx">t</span>
    <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">q</span>
    <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">p</span> <span class="o">+</span> <span class="p">(</span><span class="nx">q</span> <span class="o">-</span> <span class="nx">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="nx">t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span>
    <span class="k">return</span> <span class="nx">p</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Converts an RGB color value to HSV. Conversion formula
adapted from http://en.wikipedia.org/wiki/HSV<em>color</em>space.
Assumes r, g, and b are contained in the set [0, 255] and
returns h, s, and v in the set [0, 1].</p>

<pre>
@param   Number  r       The red color value
@param   Number  g       The green color value
@param   Number  b       The blue color value
@return  Array           The HSV representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@rgbToHSV: </span><span class="nf">(r, g, b) -&gt;</span>
    <span class="nx">r</span> <span class="o">/=</span> <span class="mi">255</span>
    <span class="nx">g</span> <span class="o">/=</span> <span class="mi">255</span>
    <span class="nx">b</span> <span class="o">/=</span> <span class="mi">255</span>

    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
    <span class="nv">min = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
    <span class="nv">v = </span><span class="nx">max</span>
    <span class="nv">d = </span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span>

    <span class="nv">s = </span><span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">d</span> <span class="o">/</span> <span class="nx">max</span>

    <span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="nx">min</span>
      <span class="nv">h = </span><span class="mi">0</span>
    <span class="k">else</span>
      <span class="nv">h = </span><span class="k">switch</span> <span class="nx">max</span>
        <span class="k">when</span> <span class="nx">r</span> <span class="k">then</span> <span class="p">(</span><span class="nx">g</span> <span class="o">-</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="nx">g</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="k">then</span> <span class="mi">6</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">when</span> <span class="nx">g</span> <span class="k">then</span> <span class="p">(</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">r</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">when</span> <span class="nx">b</span> <span class="k">then</span> <span class="p">(</span><span class="nx">r</span> <span class="o">-</span> <span class="nx">g</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">4</span>

      <span class="nx">h</span> <span class="o">/=</span> <span class="mi">6</span>

    <span class="nv">h: </span><span class="nx">h</span><span class="p">,</span> <span class="nv">s: </span><span class="nx">s</span><span class="p">,</span> <span class="nv">v: </span><span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Converts an HSV color value to RGB. Conversion formula
adapted from http://en.wikipedia.org/wiki/HSV<em>color</em>space.
Assumes h, s, and v are contained in the set [0, 1] and
returns r, g, and b in the set [0, 255].</p>

<pre>
@param   Number  h       The hue
@param   Number  s       The saturation
@param   Number  v       The value
@return  Array           The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@hsvToRGB: </span><span class="nf">(h, s, v) -&gt;</span>
    <span class="nv">i = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span>
    <span class="nv">f = </span><span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="nx">i</span>
    <span class="nv">p = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">q = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span> <span class="o">*</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">t = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span><span class="p">)</span> <span class="o">*</span> <span class="nx">s</span><span class="p">)</span>

    <span class="k">switch</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">6</span>
      <span class="k">when</span> <span class="mi">0</span>
        <span class="nv">r = </span><span class="nx">v</span>
        <span class="nv">g = </span><span class="nx">t</span>
        <span class="nv">b = </span><span class="nx">p</span>
      <span class="k">when</span> <span class="mi">1</span>
        <span class="nv">r = </span><span class="nx">q</span>
        <span class="nv">g = </span><span class="nx">v</span>
        <span class="nv">b = </span><span class="nx">p</span>
      <span class="k">when</span> <span class="mi">2</span>
        <span class="nv">r = </span><span class="nx">p</span>
        <span class="nv">g = </span><span class="nx">v</span>
        <span class="nv">b = </span><span class="nx">t</span>
      <span class="k">when</span> <span class="mi">3</span>
        <span class="nv">r = </span><span class="nx">p</span>
        <span class="nv">g = </span><span class="nx">q</span>
        <span class="nv">b = </span><span class="nx">v</span>
      <span class="k">when</span> <span class="mi">4</span>
        <span class="nv">r = </span><span class="nx">t</span>
        <span class="nv">g = </span><span class="nx">p</span>
        <span class="nv">b = </span><span class="nx">v</span>
      <span class="k">when</span> <span class="mi">5</span>
        <span class="nv">r = </span><span class="nx">v</span>
        <span class="nv">g = </span><span class="nx">p</span>
        <span class="nv">b = </span><span class="nx">q</span>

    <span class="nv">r: </span><span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nv">g: </span><span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nv">b: </span><span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Converts a RGB color value to the XYZ color space. Formulas
are based on http://en.wikipedia.org/wiki/SRGB assuming that
RGB values are sRGB.</p>

<p>Assumes r, g, and b are contained in the set [0, 255] and
returns x, y, and z.</p>

<pre>
@param   Number  r       The red color value
@param   Number  g       The green color value
@param   Number  b       The blue color value
@return  Array           The XYZ representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@rgbToXYZ: </span><span class="nf">(r, g, b) -&gt;</span>
    <span class="nx">r</span> <span class="o">/=</span> <span class="mi">255</span>
    <span class="nx">g</span> <span class="o">/=</span> <span class="mi">255</span>
    <span class="nx">b</span> <span class="o">/=</span> <span class="mi">255</span>

    <span class="k">if</span> <span class="nx">r</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
      <span class="nv">r = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">r</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">r</span> <span class="o">/=</span> <span class="mf">12.92</span>

    <span class="k">if</span> <span class="nx">g</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
      <span class="nv">g = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">g</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">g</span> <span class="o">/=</span> <span class="mf">12.92</span>

    <span class="k">if</span> <span class="nx">b</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
      <span class="nv">b = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">b</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">b</span> <span class="o">/=</span> <span class="mf">12.92</span>

    <span class="nv">x = </span><span class="nx">r</span> <span class="o">*</span> <span class="mf">0.4124</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">*</span> <span class="mf">0.3576</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">*</span> <span class="mf">0.1805</span><span class="p">;</span>
    <span class="nv">y = </span><span class="nx">r</span> <span class="o">*</span> <span class="mf">0.2126</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">*</span> <span class="mf">0.7152</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">*</span> <span class="mf">0.0722</span><span class="p">;</span>
    <span class="nv">z = </span><span class="nx">r</span> <span class="o">*</span> <span class="mf">0.0193</span> <span class="o">+</span> <span class="nx">g</span> <span class="o">*</span> <span class="mf">0.1192</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">*</span> <span class="mf">0.9505</span><span class="p">;</span>
  
    <span class="nv">x: </span><span class="nx">x</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">y: </span><span class="nx">y</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">z: </span><span class="nx">z</span> <span class="o">*</span> <span class="mi">100</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Converts a XYZ color value to the sRGB color space. Formulas
are based on http://en.wikipedia.org/wiki/SRGB and the resulting
RGB value will be in the sRGB color space.
Assumes x, y and z values are whatever they are and returns
r, g and b in the set [0, 255].</p>

<pre>
@param   Number  x       The X value
@param   Number  y       The Y value
@param   Number  z       The Z value
@return  Array           The RGB representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@xyzToRGB: </span><span class="nf">(x, y, z) -&gt;</span>
    <span class="nx">x</span> <span class="o">/=</span> <span class="mi">100</span>
    <span class="nx">y</span> <span class="o">/=</span> <span class="mi">100</span>
    <span class="nx">z</span> <span class="o">/=</span> <span class="mi">100</span>

    <span class="nv">r = </span><span class="p">(</span><span class="mf">3.2406</span>  <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.5372</span> <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.4986</span> <span class="o">*</span> <span class="nx">z</span><span class="p">)</span>
    <span class="nv">g = </span><span class="p">(</span><span class="o">-</span><span class="mf">0.9689</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.8758</span>  <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.0415</span>  <span class="o">*</span> <span class="nx">z</span><span class="p">)</span>
    <span class="nv">b = </span><span class="p">(</span><span class="mf">0.0557</span>  <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2040</span> <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0570</span>  <span class="o">*</span> <span class="nx">z</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">r</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span>
      <span class="nv">r = </span><span class="p">(</span><span class="mf">1.055</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="mf">0.4166666667</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span>
    <span class="k">else</span>
      <span class="nx">r</span> <span class="o">*=</span> <span class="mf">12.92</span>

    <span class="k">if</span> <span class="nx">g</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span>
      <span class="nv">g = </span><span class="p">(</span><span class="mf">1.055</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span> <span class="mf">0.4166666667</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span>
    <span class="k">else</span>
      <span class="nx">g</span> <span class="o">*=</span> <span class="mf">12.92</span>

    <span class="k">if</span> <span class="nx">b</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span>
      <span class="nv">b = </span><span class="p">(</span><span class="mf">1.055</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mf">0.4166666667</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span>
    <span class="k">else</span>
      <span class="nx">b</span> <span class="o">*=</span> <span class="mf">12.92</span>

    <span class="nv">r: </span><span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nv">g: </span><span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nv">b: </span><span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Converts a XYZ color value to the CIELAB color space. Formulas
are based on http://en.wikipedia.org/wiki/Lab<em>color</em>space
The reference white point used in the conversion is D65.
Assumes x, y and z values are whatever they are and returns
L<em>, a</em> and b* values</p>

<pre>
@param   Number  x       The X value
@param   Number  y       The Y value
@param   Number  z       The Z value
@return  Array           The Lab representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@xyzToLab: </span><span class="nf">(x, y, z) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">y = </span><span class="nx">x</span><span class="p">.</span><span class="nx">y</span>
      <span class="nv">z = </span><span class="nx">x</span><span class="p">.</span><span class="nx">z</span>
      <span class="nv">x = </span><span class="nx">x</span><span class="p">.</span><span class="nx">x</span>

    <span class="nv">whiteX = </span><span class="mf">95.047</span>
    <span class="nv">whiteY = </span><span class="mf">100.0</span>
    <span class="nv">whiteZ = </span><span class="mf">108.883</span>

    <span class="nx">x</span> <span class="o">/=</span> <span class="nx">whiteX</span>
    <span class="nx">y</span> <span class="o">/=</span> <span class="nx">whiteY</span>
    <span class="nx">z</span> <span class="o">/=</span> <span class="nx">whiteZ</span>

    <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mf">0.008856451679</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mf">0.3333333333</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">x = </span><span class="p">(</span><span class="mf">7.787037037</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1379310345</span>
  
    <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="mf">0.008856451679</span>
      <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="mf">0.3333333333</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">y = </span><span class="p">(</span><span class="mf">7.787037037</span> <span class="o">*</span> <span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1379310345</span>
  
    <span class="k">if</span> <span class="nx">z</span> <span class="o">&gt;</span> <span class="mf">0.008856451679</span>
      <span class="nv">z = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span> <span class="mf">0.3333333333</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">z = </span><span class="p">(</span><span class="mf">7.787037037</span> <span class="o">*</span> <span class="nx">z</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1379310345</span>

    <span class="nv">l = </span><span class="mi">116</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">-</span> <span class="mi">16</span>
    <span class="nv">a = </span><span class="mi">500</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nv">b = </span><span class="mi">200</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">z</span><span class="p">)</span>

    <span class="nv">l: </span><span class="nx">l</span><span class="p">,</span> <span class="nv">a: </span><span class="nx">a</span><span class="p">,</span> <span class="nv">b: </span><span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Converts a L<em>, a</em>, b* color values from the CIELAB color space
to the XYZ color space. Formulas are based on
http://en.wikipedia.org/wiki/Lab<em>color</em>space</p>

<p>The reference white point used in the conversion is D65.
Assumes L<em>, a</em> and b* values are whatever they are and returns
x, y and z values.</p>

<pre>
@param   Number  l       The L* value
@param   Number  a       The a* value
@param   Number  b       The b* value
@return  Array           The XYZ representation
</pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@labToXYZ: </span><span class="nf">(l, a, b) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">l</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">a = </span><span class="nx">l</span><span class="p">.</span><span class="nx">a</span>
      <span class="nv">b = </span><span class="nx">l</span><span class="p">.</span><span class="nx">b</span>
      <span class="nv">l = </span><span class="nx">l</span><span class="p">.</span><span class="nx">l</span>

    <span class="nv">y = </span><span class="p">(</span><span class="nx">l</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">116</span>
    <span class="nv">x = </span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">a</span> <span class="o">/</span> <span class="mi">500</span><span class="p">)</span>
    <span class="nv">z = </span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">b</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mf">0.2068965517</span>
      <span class="nv">x = </span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span>
    <span class="k">else</span>
      <span class="nv">x = </span><span class="mf">0.1284185493</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mf">0.1379310345</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="mf">0.2068965517</span>
      <span class="nv">y = </span><span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span>
    <span class="k">else</span>
      <span class="nv">y = </span><span class="mf">0.1284185493</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="mf">0.1379310345</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="nx">z</span> <span class="o">&gt;</span> <span class="mf">0.2068965517</span>
      <span class="nv">z = </span><span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span>
    <span class="k">else</span>
      <span class="nv">z = </span><span class="mf">0.1284185493</span> <span class="o">*</span> <span class="p">(</span><span class="nx">z</span> <span class="o">-</span> <span class="mf">0.1379310345</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>D65 reference white point</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x: </span><span class="nx">x</span> <span class="o">*</span> <span class="mf">95.047</span><span class="p">,</span> <span class="nv">y: </span><span class="nx">y</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="nv">z: </span><span class="nx">z</span> <span class="o">*</span> <span class="mf">108.883</span>

  <span class="vi">@rgbToLab: </span><span class="nf">(r, g, b) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">g = </span><span class="nx">r</span><span class="p">.</span><span class="nx">g</span>
      <span class="nv">b = </span><span class="nx">r</span><span class="p">.</span><span class="nx">b</span>
      <span class="nv">r = </span><span class="nx">r</span><span class="p">.</span><span class="nx">r</span>
    
    <span class="nv">xyz = </span><span class="nx">@rgbToXYZ</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
    <span class="nx">@xyzToLab</span> <span class="nx">xyz</span>

  <span class="vi">@labToRGB: </span><span class="nf">(l, a, b) -&gt;</span>
    

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 