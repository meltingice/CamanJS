<!DOCTYPE html>  <html> <head>   <title>io.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="events.html">                 events.js               </a>                                           <a class="source" href="filters.html">                 filters.js               </a>                                           <a class="source" href="header.html">                 header.js               </a>                                           <a class="source" href="io.html">                 io.js               </a>                                           <a class="source" href="layers.html">                 layers.js               </a>                                           <a class="source" href="loader.html">                 loader.js               </a>                                           <a class="source" href="pixelInfo.html">                 pixelInfo.js               </a>                                           <a class="source" href="render.html">                 render.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               io.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>As the name suggests, this piece of code is responsible for handling saving and exporting images from the 
Caman-initialized canvas element.</p>

<p>The save() function prompts the user to download the image. The toImage() function simply converts the 
canvas element back into an image element. Once this happens, Caman needs to be re-initialized in order 
to edit the image further. toBase64() is simply a helper that converts the canvas data to a base64 representation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global Caman: true */</span> 
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Caman</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Path to the remote image proxy, if any.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">remoteProxy</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="nx">Caman</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Grabs the canvas data, encodes it to Base64, then sets the browser location to the encoded data so that
the user will be prompted to download it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">save</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Force filetype to lowercase for consistency</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>If no valid type is given, default to PNG</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">||</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;png&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;jpg&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Redirect to a URL containing the base64 image data, which should (in most cases) cause the browser
to prompt the user with a download.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toBase64</span><span class="p">(</span><span class="nx">type</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;image/&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="s2">&quot;image/octet-stream&quot;</span><span class="p">);</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Takes the current canvas data, converts it to Base64, then sets it as the source of a new Image object
and returns it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">toImage</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">img</span><span class="p">;</span>
    
    <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toBase64</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">img</span><span class="p">;</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Grabs the current canvas data and Base64 encodes it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">toBase64</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">||</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;png&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;jpg&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s2">&quot;image/&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="p">}(</span><span class="nx">Caman</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 