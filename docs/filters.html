<!DOCTYPE html>  <html> <head>   <title>filters.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="blender.html">                 blender.coffee               </a>                                           <a class="source" href="calculate.html">                 calculate.coffee               </a>                                           <a class="source" href="caman.html">                 caman.coffee               </a>                                           <a class="source" href="camaninstance.html">                 camaninstance.coffee               </a>                                           <a class="source" href="convert.html">                 convert.coffee               </a>                                           <a class="source" href="event.html">                 event.coffee               </a>                                           <a class="source" href="filter.html">                 filter.coffee               </a>                                           <a class="source" href="io.html">                 io.coffee               </a>                                           <a class="source" href="layer.html">                 layer.coffee               </a>                                           <a class="source" href="logger.html">                 logger.coffee               </a>                                           <a class="source" href="pixelinfo.html">                 pixelinfo.coffee               </a>                                           <a class="source" href="plugin.html">                 plugin.coffee               </a>                                           <a class="source" href="renderjob.html">                 renderjob.coffee               </a>                                           <a class="source" href="store.html">                 store.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                                           <a class="source" href="blenders.html">                 blenders.coffee               </a>                                           <a class="source" href="filters.html">                 filters.coffee               </a>                                           <a class="source" href="blur.html">                 blur.coffee               </a>                                           <a class="source" href="camera.html">                 camera.coffee               </a>                                           <a class="source" href="compoundBlur.html">                 compoundBlur.coffee               </a>                                           <a class="source" href="edges.html">                 edges.coffee               </a>                                           <a class="source" href="posterize.html">                 posterize.coffee               </a>                                           <a class="source" href="presets.html">                 presets.coffee               </a>                                           <a class="source" href="stackBlur.html">                 stackBlur.coffee               </a>                                           <a class="source" href="threshold.html">                 threshold.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               filters.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The filters define all of the built-in functionality that comes with Caman (as opposed to being 
provided by a plugin). All of these filters are ratherbasic, but are extremely powerful when
many are combined. For information on creating plugins, check out the 
<a href="http://camanjs.com/docs/plugin-creation">Plugin Creation</a> page, and for information on using 
the plugins, check out the <a href="http://camanjs.com/docs/built-in">Built-In Functionality</a> page.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Fill Color</h2>

<p>Fills the canvas with a single solid color.</p>

<h3>Arguments</h3>

<p>Can take either separate R, G, and B values as arguments, or a single hex color value.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;fillColor&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
    <span class="nv">color = </span><span class="nx">Convert</span><span class="p">.</span><span class="nx">hexToRGB</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="nv">color =</span>
      <span class="nv">r: </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">g: </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">b: </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

  <span class="nx">@process</span> <span class="s2">&quot;fillColor&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">rgba.r = </span><span class="nx">color</span><span class="p">.</span><span class="nx">r</span>
    <span class="nv">rgba.g = </span><span class="nx">color</span><span class="p">.</span><span class="nx">g</span>
    <span class="nv">rgba.b = </span><span class="nx">color</span><span class="p">.</span><span class="nx">b</span>
    <span class="nv">rgba.a = </span><span class="mi">255</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Brightness</h2>

<p>Simple brightness adjustment</p>

<h3>Arguments</h3>

<p>Range is -100 to 100. Values &lt; 0 will darken image while values > 0 will brighten.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;brightness&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nv">adjust = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="nx">adjust</span> <span class="err">/ 100)</span>

  <span class="nx">@process</span> <span class="s2">&quot;brightness&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+=</span> <span class="nx">adjust</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+=</span> <span class="nx">adjust</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="nx">adjust</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Saturation</h2>

<p>Adjusts the color saturation of the image.</p>

<h3>Arguments</h3>

<p>Range is -100 to 100. Values &lt; 0 will desaturate the image while values > 0 will saturate it.
<strong>If you want to completely desaturate the image</strong>, using the greyscale filter is highly 
recommended because it will yield better results.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;saturation&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nx">adjust</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">0.01</span>

  <span class="nx">@process</span> <span class="s2">&quot;saturation&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span>

    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">*</span> <span class="nx">adjust</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">isnt</span> <span class="nx">max</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span> <span class="o">*</span> <span class="nx">adjust</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">isnt</span> <span class="nx">max</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="nx">adjust</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">isnt</span> <span class="nx">max</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Vibrance</h2>

<p>Similar to saturation, but adjusts the saturation levels in a slightly smarter, more subtle way. 
Vibrance will attempt to boost colors that are less saturated more and boost already saturated
colors less, while saturation boosts all colors by the same level.</p>

<h3>Arguments</h3>

<p>Range is -100 to 100. Values &lt; 0 will desaturate the image while values > 0 will saturate it.
<strong>If you want to completely desaturate the image</strong>, using the greyscale filter is highly 
recommended because it will yield better results.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;vibrance&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nx">adjust</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

  <span class="nx">@process</span> <span class="s2">&quot;vibrance&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span>
    <span class="nv">avg = </span><span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="nv">amt = </span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">avg</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>

    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">*</span> <span class="nx">amt</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">isnt</span> <span class="nx">max</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span> <span class="o">*</span> <span class="nx">amt</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">isnt</span> <span class="nx">max</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="nx">amt</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">isnt</span> <span class="nx">max</span>
    <span class="nx">rgba</span>
    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Greyscale</h2>

<p>An improved greyscale function that should make prettier results
than simply using the saturation filter to remove color. It does so by using factors
that directly relate to how the human eye perceves color and values. There are
no arguments, it simply makes the image greyscale with no in-between.</p>

<p>Algorithm adopted from http://www.phpied.com/image-fun/</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;greyscale&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nx">@process</span> <span class="s2">&quot;greyscale&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Calculate the average value of the 3 color channels 
using the special factors</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">avg = </span><span class="mf">0.3</span> <span class="o">*</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+</span> <span class="mf">0.59</span> <span class="o">*</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+</span> <span class="mf">0.11</span> <span class="o">*</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span>

    <span class="nv">rgba.r = </span><span class="nx">avg</span>
    <span class="nv">rgba.g = </span><span class="nx">avg</span>
    <span class="nv">rgba.b = </span><span class="nx">avg</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Contrast</h2>

<p>Increases or decreases the color contrast of the image.</p>

<h3>Arguments</h3>

<p>Range is -100 to 100. Values &lt; 0 will decrease contrast while values > 0 will increase contrast.
The contrast adjustment values are a bit sensitive. While unrestricted, sane adjustment values 
are usually around 5-10.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nv">adjust = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">((</span><span class="nx">adjust</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

  <span class="nx">@process</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Red channel</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="err">/= 255;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">*=</span> <span class="nx">adjust</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">*=</span> <span class="mi">255</span><span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Green channel</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="err">/= 255;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">*=</span> <span class="nx">adjust</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">*=</span> <span class="mi">255</span><span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Blue channel</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="err">/= 255;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">*=</span> <span class="nx">adjust</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">*=</span> <span class="mi">255</span><span class="p">;</span>

    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>Hue</h2>

<p>Adjusts the hue of the image. It can be used to shift the colors in an image in a uniform 
fashion. If you are unfamiliar with Hue, I recommend reading this 
<a href="http://en.wikipedia.org/wiki/Hue">Wikipedia article</a>.</p>

<h3>Arguments</h3>

<p>Range is 0 to 100
Sometimes, Hue is expressed in the range of 0 to 360. If that's the terminology you're used to, 
think of 0 to 100 representing the percentage of Hue shift in the 0 to 360 range.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;hue&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nx">@process</span> <span class="s2">&quot;hue&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">hsv = </span><span class="nx">Convert</span><span class="p">.</span><span class="nx">rgbToHSV</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span>
    
    <span class="nv">h = </span><span class="nx">hsv</span><span class="p">.</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nx">h</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">adjust</span>
    <span class="nv">h = </span><span class="nx">h</span> <span class="o">%</span> <span class="mi">100</span>
    <span class="nx">h</span> <span class="err">/= 100</span>
    <span class="nv">hsv.h = </span><span class="nx">h</span>

    <span class="nv">rgb = </span><span class="nx">Convert</span><span class="p">.</span><span class="nx">hsvToRGB</span> <span class="nx">hsv</span><span class="p">.</span><span class="nx">h</span><span class="p">,</span> <span class="nx">hsv</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">hsv</span><span class="p">.</span><span class="nx">v</span>
    <span class="nv">rgb.a = </span><span class="nx">rgba</span><span class="p">.</span><span class="nx">a</span>
    <span class="nx">rgb</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>Colorize</h2>

<p>Uniformly shifts the colors in an image towards the given color. The adjustment range is from 0 
to 100. The higher the value, the closer the colors in the image shift towards the given 
adjustment color.</p>

<h3>Arguments</h3>

<p>This filter is polymorphic and can take two different sets of arguments. Either a hex color 
string and an adjustment value, or RGB colors and an adjustment value.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;colorize&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">2</span>
    <span class="nv">rgb = </span><span class="nx">Convert</span><span class="p">.</span><span class="nx">hexToRGB</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nv">level = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">4</span>
    <span class="nv">rgb =</span>
      <span class="nv">r: </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">g: </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">b: </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="nv">level = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

  <span class="nx">@process</span> <span class="s2">&quot;colorize&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">-</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">level</span> <span class="err">/ 100)</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">-</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">level</span> <span class="err">/ 100)</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">level</span> <span class="err">/ 100)</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h2>Invert</h2>

<p>Inverts all colors in the image by subtracting each color channel value from 255. No arguments.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="nx">@process</span> <span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">rgba.r = </span><span class="mi">255</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span>
    <span class="nv">rgba.g = </span><span class="mi">255</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span>
    <span class="nv">rgba.b = </span><span class="mi">255</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span>
    <span class="nx">rgba</span>
    </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Sepia</h2>

<p>Applies an adjustable sepia filter to the image.</p>

<h3>Arguments</h3>

<p>Assumes adjustment is between 0 and 100, which represents how much the sepia filter is applied.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;sepia&quot;</span><span class="p">,</span> <span class="nf">(adjust = 100) -&gt;</span>
  <span class="nx">adjust</span> <span class="err">/= 100</span>

  <span class="nx">@process</span> <span class="s2">&quot;sepia&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>All three color channels have special conversion factors that 
define what sepia is. Here we adjust each channel individually, 
with the twist that you can partially apply the sepia filter.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">rgba.r = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.607</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.769</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.189</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">)));</span>
    <span class="nv">rgba.g = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.349</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.314</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.168</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">)));</span>
    <span class="nv">rgba.b = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.272</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.534</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="p">(</span><span class="mf">0.869</span> <span class="o">*</span> <span class="nx">adjust</span><span class="p">))));</span>

    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>Gamma</h2>

<p>Adjusts the gamma of the image.</p>

<h3>Arguments</h3>

<p>Range is from 0 to infinity, although sane values are from 0 to 4 or 5.
Values between 0 and 1 will lessen the contrast while values greater than 1 will increase it.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nx">@process</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">rgba.r = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="err">/ 255, adjust) * 255</span>
    <span class="nv">rgba.g = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="err">/ 255, adjust) * 255</span>
    <span class="nv">rgba.b = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="err">/ 255, adjust) * 255</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Noise</h2>

<p>Adds noise to the image on a scale from 1 - 100. However, the scale isn't constrained, so you 
can specify a value > 100 if you want a LOT of noise.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;noise&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nv">adjust = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">adjust</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.55</span>
  
  <span class="nx">@process</span> <span class="s2">&quot;noise&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="nv">rand = </span><span class="nx">Calculate</span><span class="p">.</span><span class="nx">randomRange</span> <span class="nx">adjust</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">adjust</span>

    <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+=</span> <span class="nx">rand</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+=</span> <span class="nx">rand</span>
    <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="nx">rand</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h2>Clip</h2>

<p>Clips a color to max values when it falls outside of the specified range.</p>

<h3>Arguments</h3>

<p>Supplied value should be between 0 and 100.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;clip&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nv">adjust = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">adjust</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.55</span>

  <span class="nx">@process</span> <span class="s2">&quot;clip&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">adjust</span>
      <span class="nv">rgba.r = </span><span class="mi">255</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">&lt;</span> <span class="nx">adjust</span>
      <span class="nv">rgba.r = </span><span class="mi">0</span>

    <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">adjust</span>
      <span class="nv">rgba.g = </span><span class="mi">255</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">&lt;</span> <span class="nx">adjust</span>
      <span class="nv">rgba.g = </span><span class="mi">0</span>
      
    <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">adjust</span>
      <span class="nv">rgba.b = </span><span class="mi">255</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">adjust</span>
      <span class="nv">rgba.b = </span><span class="mi">0</span>

    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>Channels</h2>

<p>Lets you modify the intensity of any combination of red, green, or blue channels individually.</p>

<h3>Arguments</h3>

<p>Must be given at least one color channel to adjust in order to work.
Options format (must specify 1 - 3 colors):</p>

<pre>{
  red: 20,
  green: -5,
  blue: -40
}</pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;channels&quot;</span><span class="p">,</span> <span class="nf">(options) -&gt;</span>
  <span class="k">return</span> <span class="err">@</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">isnt</span> <span class="s2">&quot;object&quot;</span>

  <span class="k">for</span> <span class="nx">own</span> <span class="nx">chan</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">options</span>
    <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">delete</span> <span class="nx">options</span><span class="p">[</span><span class="nx">chan</span><span class="p">]</span>
      <span class="k">continue</span>

    <span class="nx">options</span><span class="p">[</span><span class="nx">chan</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">100</span>

  <span class="k">return</span> <span class="err">@</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>

  <span class="nx">@process</span> <span class="s2">&quot;channels&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span>
    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">red</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">red</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">*</span> <span class="nx">options</span><span class="p">.</span><span class="nx">red</span>
      <span class="k">else</span>
        <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">-=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">red</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">green</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">green</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span> <span class="o">*</span> <span class="nx">options</span><span class="p">.</span><span class="nx">green</span>
      <span class="k">else</span>
        <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">-=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">green</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">blue</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">blue</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="nx">options</span><span class="p">.</span><span class="nx">blue</span>
      <span class="k">else</span>
        <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">-=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">blue</span><span class="p">)</span>

    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h2>Curves</h2>

<p>Curves implementation using Bezier curve equation. If you're familiar with the Curves 
functionality in Photoshop, this works in a very similar fashion.</p>

<h3>Arguments.</h3>

<pre>
  chan - [r, g, b, rgb]
  start - [x, y] (start of curve; 0 - 255)
  ctrl1 - [x, y] (control point 1; 0 - 255)
  ctrl2 - [x, y] (control point 2; 0 - 255)
  end   - [x, y] (end of curve; 0 - 255)
</pre>

<p>The first argument represents the channels you wish to modify with the filter. It can be an 
array of channels or a string (for a single channel). The rest of the arguments are 2-element 
arrays that represent point coordinates. They are specified in the same order as shown in this 
image to the right. The coordinates are in the range of 0 to 255 for both X and Y values.</p>

<p>The x-axis represents the input value for a single channel, while the y-axis represents the 
output value.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;curves&quot;</span><span class="p">,</span> <span class="nf">(chans, start, ctrl1, ctrl2, end) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If channels are in a string, split to an array</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chans = </span><span class="nx">chans</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">chans</span> <span class="o">is</span> <span class="s2">&quot;string&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Generate a bezier curve</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bezier = </span><span class="nx">Calculate</span><span class="p">.</span><span class="nx">bezier</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">ctrl1</span><span class="p">,</span> <span class="nx">ctrl2</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>If the curve starts after x = 0, initialize it with a flat line
until the curve begins.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">bezier</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="nx">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>... and the same with the end point</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">bezier</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]..</span><span class="mi">255</span><span class="p">]</span> <span class="k">if</span> <span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">255</span>

  <span class="nx">@process</span> <span class="s2">&quot;curves&quot;</span><span class="p">,</span> <span class="nf">(rgba) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Now that we have the bezier curve, we do a basic hashmap lookup
to find and replace color values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rgba</span><span class="p">[</span><span class="nx">chans</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">bezier</span><span class="p">[</span><span class="nx">rgba</span><span class="p">[</span><span class="nx">chans</span><span class="p">[</span><span class="nx">i</span><span class="p">]]]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">chans</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
    <span class="nx">rgba</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h2>Exposure</h2>

<p>Adjusts the exposure of the image by using the curves function.</p>

<h3>Arguments</h3>

<p>Range is -100 to 100. Values &lt; 0 will decrease exposure while values > 0 will increase exposure.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="nf">(adjust) -&gt;</span>
  <span class="nv">p = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">adjust</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>

  <span class="nv">ctrl1 = </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span> <span class="o">*</span> <span class="nx">p</span><span class="p">]</span>
  <span class="nv">ctrl2 = </span><span class="p">[</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="nx">p</span><span class="p">),</span> <span class="mi">255</span><span class="p">]</span>

  <span class="k">if</span> <span class="nx">adjust</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">ctrl1 = </span><span class="nx">ctrl1</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nv">ctrl2 = </span><span class="nx">ctrl2</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>

  <span class="nx">@curves</span> <span class="s1">&#39;rgb&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nx">ctrl1</span><span class="p">,</span> <span class="nx">ctrl2</span><span class="p">,</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 