<!DOCTYPE html>  <html> <head>   <title>stackBlur.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="blender.html">                 blender.coffee               </a>                                           <a class="source" href="calculate.html">                 calculate.coffee               </a>                                           <a class="source" href="caman.html">                 caman.coffee               </a>                                           <a class="source" href="camaninstance.html">                 camaninstance.coffee               </a>                                           <a class="source" href="convert.html">                 convert.coffee               </a>                                           <a class="source" href="event.html">                 event.coffee               </a>                                           <a class="source" href="filter.html">                 filter.coffee               </a>                                           <a class="source" href="io.html">                 io.coffee               </a>                                           <a class="source" href="layer.html">                 layer.coffee               </a>                                           <a class="source" href="logger.html">                 logger.coffee               </a>                                           <a class="source" href="pixelinfo.html">                 pixelinfo.coffee               </a>                                           <a class="source" href="plugin.html">                 plugin.coffee               </a>                                           <a class="source" href="renderjob.html">                 renderjob.coffee               </a>                                           <a class="source" href="store.html">                 store.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                                           <a class="source" href="blenders.html">                 blenders.coffee               </a>                                           <a class="source" href="filters.html">                 filters.coffee               </a>                                           <a class="source" href="blur.html">                 blur.coffee               </a>                                           <a class="source" href="camera.html">                 camera.coffee               </a>                                           <a class="source" href="compoundBlur.html">                 compoundBlur.coffee               </a>                                           <a class="source" href="edges.html">                 edges.coffee               </a>                                           <a class="source" href="posterize.html">                 posterize.coffee               </a>                                           <a class="source" href="presets.html">                 presets.coffee               </a>                                           <a class="source" href="stackBlur.html">                 stackBlur.coffee               </a>                                           <a class="source" href="threshold.html">                 threshold.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               stackBlur.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">StackBlur</span> <span class="o">-</span> <span class="nx">a</span> <span class="nx">fast</span> <span class="nx">almost</span> <span class="nx">Gaussian</span> <span class="nx">Blur</span> <span class="nx">For</span> <span class="nx">Canvas</span> <span class="nx">v0</span><span class="p">.</span><span class="mi">31</span> <span class="nx">modified</span> <span class="k">for</span> <span class="nx">CamanJS</span>

<span class="nv">Version: </span>  <span class="mf">0.31</span>
<span class="nv">Author: </span>   <span class="nx">Mario</span> <span class="nx">Klingemann</span>
<span class="nv">Contact: </span>  <span class="nx">mario@quasimondo</span><span class="p">.</span><span class="nx">com</span>
<span class="nv">Website: </span> <span class="nx">http</span><span class="o">:</span><span class="err">//www.quasimondo.com/StackBlurForCanvas</span>
<span class="nv">Twitter: </span> <span class="nx">@quasimondo</span>
<span class="nx">Modified</span> <span class="nv">By: </span><span class="nx">Ryan</span> <span class="nx">LeFevre</span> <span class="p">(</span><span class="nx">@meltingice</span><span class="p">)</span>

<span class="nx">In</span> <span class="nx">case</span> <span class="nx">you</span> <span class="nx">find</span> <span class="k">this</span> <span class="k">class</span> <span class="nx">useful</span> <span class="o">-</span> <span class="nx">especially</span> <span class="k">in</span> <span class="nx">commercial</span> <span class="nx">projects</span> <span class="o">-</span>
<span class="nx">I</span> <span class="nx">am</span> <span class="o">not</span> <span class="nx">totally</span> <span class="nx">unhappy</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">small</span> <span class="nx">donation</span> <span class="nx">to</span> <span class="nx">my</span> <span class="nx">PayPal</span> <span class="nx">account</span>
<span class="nx">mario@quasimondo</span><span class="p">.</span><span class="nx">de</span>

<span class="nx">Or</span> <span class="nx">support</span> <span class="nx">me</span> <span class="kc">on</span> <span class="nv">flattr: </span>
<span class="nx">https</span><span class="o">:</span><span class="err">//flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript</span>

<span class="nx">Copyright</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="mi">2010</span> <span class="nx">Mario</span> <span class="nx">Klingemann</span>

<span class="nx">Permission</span> <span class="o">is</span> <span class="nx">hereby</span> <span class="nx">granted</span><span class="p">,</span> <span class="nx">free</span> <span class="k">of</span> <span class="nx">charge</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">any</span> <span class="nx">person</span>
<span class="nx">obtaining</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="k">of</span> <span class="k">this</span> <span class="nx">software</span> <span class="o">and</span> <span class="nx">associated</span> <span class="nx">documentation</span>
<span class="nx">files</span> <span class="p">(</span><span class="nx">the</span> <span class="s2">&quot;Software&quot;</span><span class="p">),</span> <span class="nx">to</span> <span class="nx">deal</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">Software</span> <span class="nx">without</span>
<span class="nx">restriction</span><span class="p">,</span> <span class="nx">including</span> <span class="nx">without</span> <span class="nx">limitation</span> <span class="nx">the</span> <span class="nx">rights</span> <span class="nx">to</span> <span class="nx">use</span><span class="p">,</span>
<span class="nx">copy</span><span class="p">,</span> <span class="nx">modify</span><span class="p">,</span> <span class="nx">merge</span><span class="p">,</span> <span class="nx">publish</span><span class="p">,</span> <span class="nx">distribute</span><span class="p">,</span> <span class="nx">sublicense</span><span class="p">,</span> <span class="o">and</span><span class="err">/or sell</span>
<span class="nx">copies</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">Software</span><span class="p">,</span> <span class="o">and</span> <span class="nx">to</span> <span class="nx">permit</span> <span class="nx">persons</span> <span class="nx">to</span> <span class="nx">whom</span> <span class="nx">the</span>
<span class="nx">Software</span> <span class="o">is</span> <span class="nx">furnished</span> <span class="nx">to</span> <span class="nx">do</span> <span class="nx">so</span><span class="p">,</span> <span class="nx">subject</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">following</span>
<span class="nv">conditions:</span>

<span class="nx">The</span> <span class="nx">above</span> <span class="nx">copyright</span> <span class="nx">notice</span> <span class="o">and</span> <span class="k">this</span> <span class="nx">permission</span> <span class="nx">notice</span> <span class="nx">shall</span> <span class="nx">be</span>
<span class="nx">included</span> <span class="k">in</span> <span class="nx">all</span> <span class="nx">copies</span> <span class="o">or</span> <span class="nx">substantial</span> <span class="nx">portions</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">Software</span><span class="p">.</span>

<span class="nx">THE</span> <span class="nx">SOFTWARE</span> <span class="nx">IS</span> <span class="nx">PROVIDED</span> <span class="s2">&quot;AS IS&quot;</span><span class="p">,</span> <span class="nx">WITHOUT</span> <span class="nx">WARRANTY</span> <span class="nx">OF</span> <span class="nx">ANY</span> <span class="nx">KIND</span><span class="p">,</span>
<span class="nx">EXPRESS</span> <span class="nx">OR</span> <span class="nx">IMPLIED</span><span class="p">,</span> <span class="nx">INCLUDING</span> <span class="nx">BUT</span> <span class="nx">NOT</span> <span class="nx">LIMITED</span> <span class="nx">TO</span> <span class="nx">THE</span> <span class="nx">WARRANTIES</span>
<span class="nx">OF</span> <span class="nx">MERCHANTABILITY</span><span class="p">,</span> <span class="nx">FITNESS</span> <span class="nx">FOR</span> <span class="nx">A</span> <span class="nx">PARTICULAR</span> <span class="nx">PURPOSE</span> <span class="nx">AND</span>
<span class="nx">NONINFRINGEMENT</span><span class="p">.</span> <span class="nx">IN</span> <span class="nx">NO</span> <span class="nx">EVENT</span> <span class="nx">SHALL</span> <span class="nx">THE</span> <span class="nx">AUTHORS</span> <span class="nx">OR</span> <span class="nx">COPYRIGHT</span>
<span class="nx">HOLDERS</span> <span class="nx">BE</span> <span class="nx">LIABLE</span> <span class="nx">FOR</span> <span class="nx">ANY</span> <span class="nx">CLAIM</span><span class="p">,</span> <span class="nx">DAMAGES</span> <span class="nx">OR</span> <span class="nx">OTHER</span> <span class="nx">LIABILITY</span><span class="p">,</span>
<span class="nx">WHETHER</span> <span class="nx">IN</span> <span class="nx">AN</span> <span class="nx">ACTION</span> <span class="nx">OF</span> <span class="nx">CONTRACT</span><span class="p">,</span> <span class="nx">TORT</span> <span class="nx">OR</span> <span class="nx">OTHERWISE</span><span class="p">,</span> <span class="nx">ARISING</span>
<span class="nx">FROM</span><span class="p">,</span> <span class="nx">OUT</span> <span class="nx">OF</span> <span class="nx">OR</span> <span class="nx">IN</span> <span class="nx">CONNECTION</span> <span class="nx">WITH</span> <span class="nx">THE</span> <span class="nx">SOFTWARE</span> <span class="nx">OR</span> <span class="nx">THE</span> <span class="nx">USE</span> <span class="nx">OR</span>
<span class="nx">OTHER</span> <span class="nx">DEALINGS</span> <span class="nx">IN</span> <span class="nx">THE</span> <span class="nx">SOFTWARE</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">do</span> <span class="o">-&gt;</span>

  <span class="nv">mul_table = </span><span class="p">[</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">388</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">364</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">496</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">388</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">482</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">428</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">383</span><span class="p">,</span> <span class="mi">364</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">259</span><span class="p">,</span> <span class="mi">496</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">437</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">388</span><span class="p">,</span> <span class="mi">374</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">282</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">497</span><span class="p">,</span> <span class="mi">482</span><span class="p">,</span> <span class="mi">468</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">441</span><span class="p">,</span> <span class="mi">428</span><span class="p">,</span> <span class="mi">417</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">394</span><span class="p">,</span> <span class="mi">383</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">364</span><span class="p">,</span> <span class="mi">354</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">291</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">278</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">259</span><span class="p">,</span> <span class="mi">507</span><span class="p">,</span> <span class="mi">496</span><span class="p">,</span> <span class="mi">485</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">446</span><span class="p">,</span> <span class="mi">437</span><span class="p">,</span> <span class="mi">428</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">412</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span> <span class="mi">388</span><span class="p">,</span> <span class="mi">381</span><span class="p">,</span> <span class="mi">374</span><span class="p">,</span> <span class="mi">367</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">354</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">329</span><span class="p">,</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">318</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">282</span><span class="p">,</span> <span class="mi">278</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">269</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">261</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">505</span><span class="p">,</span> <span class="mi">497</span><span class="p">,</span> <span class="mi">489</span><span class="p">,</span> <span class="mi">482</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">468</span><span class="p">,</span> <span class="mi">461</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">447</span><span class="p">,</span> <span class="mi">441</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">428</span><span class="p">,</span> <span class="mi">422</span><span class="p">,</span> <span class="mi">417</span><span class="p">,</span> <span class="mi">411</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">399</span><span class="p">,</span> <span class="mi">394</span><span class="p">,</span> <span class="mi">389</span><span class="p">,</span> <span class="mi">383</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">368</span><span class="p">,</span> <span class="mi">364</span><span class="p">,</span> <span class="mi">359</span><span class="p">,</span> <span class="mi">354</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">316</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">309</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">291</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">281</span><span class="p">,</span> <span class="mi">278</span><span class="p">,</span> <span class="mi">274</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">268</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">262</span><span class="p">,</span> <span class="mi">259</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">507</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="mi">496</span><span class="p">,</span> <span class="mi">491</span><span class="p">,</span> <span class="mi">485</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">470</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">451</span><span class="p">,</span> <span class="mi">446</span><span class="p">,</span> <span class="mi">442</span><span class="p">,</span> <span class="mi">437</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">428</span><span class="p">,</span> <span class="mi">424</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">412</span><span class="p">,</span> <span class="mi">408</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span> <span class="mi">392</span><span class="p">,</span> <span class="mi">388</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mi">381</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">374</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">367</span><span class="p">,</span> <span class="mi">363</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">357</span><span class="p">,</span> <span class="mi">354</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">344</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">338</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">329</span><span class="p">,</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">318</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">299</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">282</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">278</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">269</span><span class="p">,</span> <span class="mi">267</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">263</span><span class="p">,</span> <span class="mi">261</span><span class="p">,</span> <span class="mi">259</span> <span class="p">]</span>

  <span class="nv">shg_table = </span><span class="p">[</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span> <span class="p">]</span>

  <span class="nv">BlurStack = </span><span class="o">-&gt;</span>
    <span class="vi">@r = </span><span class="mi">0</span>
    <span class="vi">@g = </span><span class="mi">0</span>
    <span class="vi">@b = </span><span class="mi">0</span>
    <span class="vi">@a = </span><span class="mi">0</span>
    <span class="vi">@next = </span><span class="kc">null</span>

  <span class="nx">Caman</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;stackBlur&quot;</span><span class="p">,</span> <span class="nf">(radius) -&gt;</span>
    <span class="k">return</span>  <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">radius</span><span class="p">)</span> <span class="o">or</span> <span class="nx">radius</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="nx">radius</span> <span class="o">|=</span> <span class="mi">0</span>

    <span class="nv">pixels = </span><span class="nx">@pixelData</span>
    <span class="nv">width = </span><span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span>
    <span class="nv">height = </span><span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span>

    <span class="nv">div = </span><span class="nx">radius</span> <span class="o">+</span> <span class="nx">radius</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nv">w4 = </span><span class="nx">width</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
    <span class="nv">widthMinus1 = </span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nv">heightMinus1 = </span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nv">radiusPlus1 = </span><span class="nx">radius</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nv">sumFactor = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nx">radiusPlus1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nv">stackStart = </span><span class="k">new</span> <span class="nx">BlurStack</span><span class="p">()</span>
    <span class="nv">stack = </span><span class="nx">stackStart</span>
    
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">...</span><span class="nx">div</span><span class="p">]</span>
      <span class="nv">stack = stack.next = </span><span class="k">new</span> <span class="nx">BlurStack</span><span class="p">()</span>
      <span class="nv">stackEnd = </span><span class="nx">stack</span> <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="nx">radiusPlus1</span>
      
    <span class="nv">stack.next = </span><span class="nx">stackStart</span>
    <span class="nv">stackIn = </span><span class="kc">null</span>
    <span class="nv">stackOut = </span><span class="kc">null</span>

    <span class="nv">yw = yi = </span><span class="mi">0</span>

    <span class="nv">mul_sum = </span><span class="nx">mul_table</span><span class="p">[</span><span class="nx">radius</span><span class="p">]</span>
    <span class="nv">shg_sum = </span><span class="nx">shg_table</span><span class="p">[</span><span class="nx">radius</span><span class="p">]</span>

    <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">height</span><span class="p">]</span>
      <span class="nv">r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = </span><span class="mi">0</span>

      <span class="nv">r_out_sum = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nv">pr = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span><span class="p">])</span>
      <span class="nv">g_out_sum = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nv">pg = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
      <span class="nv">b_out_sum = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nv">pb = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
      
      <span class="nx">r_sum</span> <span class="o">+=</span> <span class="nx">sumFactor</span> <span class="o">*</span> <span class="nx">pr</span>
      <span class="nx">g_sum</span> <span class="o">+=</span> <span class="nx">sumFactor</span> <span class="o">*</span> <span class="nx">pg</span>
      <span class="nx">b_sum</span> <span class="o">+=</span> <span class="nx">sumFactor</span> <span class="o">*</span> <span class="nx">pb</span>
      
      <span class="nv">stack = </span><span class="nx">stackStart</span>
      
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">radiusPlus1</span><span class="p">]</span>
        <span class="nv">stack.r = </span><span class="nx">pr</span>
        <span class="nv">stack.g = </span><span class="nx">pg</span>
        <span class="nv">stack.b = </span><span class="nx">pb</span>
        <span class="nv">stack = </span><span class="nx">stack</span><span class="p">.</span><span class="nx">next</span>
        
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">...</span><span class="nx">radiusPlus1</span><span class="p">]</span>
        <span class="nv">p = </span><span class="nx">yi</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">widthMinus1</span> <span class="o">&lt;</span> <span class="nx">i</span> <span class="k">then</span> <span class="nx">widthMinus1</span> <span class="k">else</span> <span class="nx">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nx">r_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stack.r = </span><span class="p">(</span><span class="nv">pr = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="nv">rbs = </span><span class="nx">radiusPlus1</span> <span class="o">-</span> <span class="nx">i</span><span class="p">)</span>
        <span class="nx">g_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stack.g = </span><span class="p">(</span><span class="nv">pg = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="nx">rbs</span>
        <span class="nx">b_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stack.b = </span><span class="p">(</span><span class="nv">pb = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span> <span class="o">*</span> <span class="nx">rbs</span>

        <span class="nx">r_in_sum</span> <span class="o">+=</span> <span class="nx">pr</span>
        <span class="nx">g_in_sum</span> <span class="o">+=</span> <span class="nx">pg</span>
        <span class="nx">b_in_sum</span> <span class="o">+=</span> <span class="nx">pb</span>

        <span class="nv">stack = </span><span class="nx">stack</span><span class="p">.</span><span class="nx">next</span>
        
      <span class="nv">stackIn = </span><span class="nx">stackStart</span>
      <span class="nv">stackOut = </span><span class="nx">stackEnd</span>
      
      <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">width</span><span class="p">]</span>
        <span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">r_sum</span> <span class="o">*</span> <span class="nx">mul_sum</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="nx">shg_sum</span>
        <span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">g_sum</span> <span class="o">*</span> <span class="nx">mul_sum</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="nx">shg_sum</span>
        <span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b_sum</span> <span class="o">*</span> <span class="nx">mul_sum</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="nx">shg_sum</span>

        <span class="nx">r_sum</span> <span class="o">-=</span> <span class="nx">r_out_sum</span>
        <span class="nx">g_sum</span> <span class="o">-=</span> <span class="nx">g_out_sum</span>
        <span class="nx">b_sum</span> <span class="o">-=</span> <span class="nx">b_out_sum</span>

        <span class="nx">r_out_sum</span> <span class="o">-=</span> <span class="nx">stackIn</span><span class="p">.</span><span class="nx">r</span>
        <span class="nx">g_out_sum</span> <span class="o">-=</span> <span class="nx">stackIn</span><span class="p">.</span><span class="nx">g</span>
        <span class="nx">b_out_sum</span> <span class="o">-=</span> <span class="nx">stackIn</span><span class="p">.</span><span class="nx">b</span>

        <span class="nv">p = </span><span class="p">(</span><span class="nx">yw</span> <span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">p = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">widthMinus1</span> <span class="k">then</span> <span class="nx">p</span> <span class="k">else</span> <span class="nx">widthMinus1</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>

        <span class="nx">r_in_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stackIn.r = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span><span class="p">])</span>
        <span class="nx">g_in_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stackIn.g = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="nx">b_in_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stackIn.b = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>

        <span class="nx">r_sum</span> <span class="o">+=</span> <span class="nx">r_in_sum</span>
        <span class="nx">g_sum</span> <span class="o">+=</span> <span class="nx">g_in_sum</span>
        <span class="nx">b_sum</span> <span class="o">+=</span> <span class="nx">b_in_sum</span>

        <span class="nv">stackIn = </span><span class="nx">stackIn</span><span class="p">.</span><span class="nx">next</span>

        <span class="nx">r_out_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">pr = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span>
        <span class="nx">g_out_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">pg = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span>
        <span class="nx">b_out_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">pb = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>

        <span class="nx">r_in_sum</span> <span class="o">-=</span> <span class="nx">pr</span>
        <span class="nx">g_in_sum</span> <span class="o">-=</span> <span class="nx">pg</span>
        <span class="nx">b_in_sum</span> <span class="o">-=</span> <span class="nx">pb</span>

        <span class="nv">stackOut = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">next</span>

        <span class="nx">yi</span> <span class="o">+=</span> <span class="mi">4</span>
        
      <span class="nx">yw</span> <span class="o">+=</span> <span class="nx">width</span>
      
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">width</span><span class="p">]</span>
      <span class="nv">g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = </span><span class="mi">0</span>

      <span class="nv">yi = </span><span class="nx">x</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
      <span class="nv">r_out_sum = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nv">pr = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span><span class="p">])</span>
      <span class="nv">g_out_sum = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nv">pg = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
      <span class="nv">b_out_sum = </span><span class="nx">radiusPlus1</span> <span class="o">*</span> <span class="p">(</span><span class="nv">pb = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>

      <span class="nx">r_sum</span> <span class="o">+=</span> <span class="nx">sumFactor</span> <span class="o">*</span> <span class="nx">pr</span>
      <span class="nx">g_sum</span> <span class="o">+=</span> <span class="nx">sumFactor</span> <span class="o">*</span> <span class="nx">pg</span>
      <span class="nx">b_sum</span> <span class="o">+=</span> <span class="nx">sumFactor</span> <span class="o">*</span> <span class="nx">pb</span>

      <span class="nv">stack = </span><span class="nx">stackStart</span>

      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">radiusPlus1</span><span class="p">]</span>
        <span class="nv">stack.r = </span><span class="nx">pr</span>
        <span class="nv">stack.g = </span><span class="nx">pg</span>
        <span class="nv">stack.b = </span><span class="nx">pb</span>
        <span class="nv">stack = </span><span class="nx">stack</span><span class="p">.</span><span class="nx">next</span>
        
      <span class="nv">yp = </span><span class="nx">width</span>
      
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="nx">radius</span><span class="p">]</span>
        <span class="nv">yi = </span><span class="p">(</span><span class="nx">yp</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>

        <span class="nx">r_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stack.r = </span><span class="p">(</span><span class="nv">pr = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="nv">rbs = </span><span class="nx">radiusPlus1</span> <span class="o">-</span> <span class="nx">i</span><span class="p">)</span>
        <span class="nx">g_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stack.g = </span><span class="p">(</span><span class="nv">pg = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="nx">rbs</span>
        <span class="nx">b_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stack.b = </span><span class="p">(</span><span class="nv">pb = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">yi</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span> <span class="o">*</span> <span class="nx">rbs</span>

        <span class="nx">r_in_sum</span> <span class="o">+=</span> <span class="nx">pr</span>
        <span class="nx">g_in_sum</span> <span class="o">+=</span> <span class="nx">pg</span>
        <span class="nx">b_in_sum</span> <span class="o">+=</span> <span class="nx">pb</span>

        <span class="nv">stack = </span><span class="nx">stack</span><span class="p">.</span><span class="nx">next</span>

        <span class="nx">yp</span> <span class="o">+=</span> <span class="nx">width</span> <span class="k">if</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">heightMinus1</span>
        
      <span class="nv">yi = </span><span class="nx">x</span>
      <span class="nv">stackIn = </span><span class="nx">stackStart</span>
      <span class="nv">stackOut = </span><span class="nx">stackEnd</span>
      
      <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">height</span><span class="p">]</span>
        <span class="nv">p = </span><span class="nx">yi</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
        <span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">r_sum</span> <span class="o">*</span> <span class="nx">mul_sum</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="nx">shg_sum</span>
        <span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">g_sum</span> <span class="o">*</span> <span class="nx">mul_sum</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="nx">shg_sum</span>
        <span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b_sum</span> <span class="o">*</span> <span class="nx">mul_sum</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="nx">shg_sum</span>

        <span class="nx">r_sum</span> <span class="o">-=</span> <span class="nx">r_out_sum</span>
        <span class="nx">g_sum</span> <span class="o">-=</span> <span class="nx">g_out_sum</span>
        <span class="nx">b_sum</span> <span class="o">-=</span> <span class="nx">b_out_sum</span>

        <span class="nx">r_out_sum</span> <span class="o">-=</span> <span class="nx">stackIn</span><span class="p">.</span><span class="nx">r</span>
        <span class="nx">g_out_sum</span> <span class="o">-=</span> <span class="nx">stackIn</span><span class="p">.</span><span class="nx">g</span>
        <span class="nx">b_out_sum</span> <span class="o">-=</span> <span class="nx">stackIn</span><span class="p">.</span><span class="nx">b</span>

        <span class="nv">p = </span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nv">p = </span><span class="nx">y</span> <span class="o">+</span> <span class="nx">radiusPlus1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">heightMinus1</span> <span class="k">then</span> <span class="nx">p</span> <span class="k">else</span> <span class="nx">heightMinus1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">width</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
        
        <span class="nx">r_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">r_in_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stackIn.r = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span><span class="p">]))</span>
        <span class="nx">g_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">g_in_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stackIn.g = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="nx">b_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">b_in_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">stackIn.b = </span><span class="nx">pixels</span><span class="p">[</span><span class="nx">p</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
        
        <span class="nv">stackIn = </span><span class="nx">stackIn</span><span class="p">.</span><span class="nx">next</span>
        
        <span class="nx">r_out_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">pr = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span>
        <span class="nx">g_out_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">pg = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span>
        <span class="nx">b_out_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">pb = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>
        
        <span class="nx">r_in_sum</span> <span class="o">-=</span> <span class="nx">pr</span>
        <span class="nx">g_in_sum</span> <span class="o">-=</span> <span class="nx">pg</span>
        <span class="nx">b_in_sum</span> <span class="o">-=</span> <span class="nx">pb</span>
        
        <span class="nv">stackOut = </span><span class="nx">stackOut</span><span class="p">.</span><span class="nx">next</span>
        
        <span class="nx">yi</span> <span class="o">+=</span> <span class="nx">width</span>
        
      
    <span class="err">@</span>

  <span class="nx">Caman</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">register</span> <span class="s2">&quot;stackBlur&quot;</span><span class="p">,</span> <span class="nf">(radius) -&gt;</span>
    <span class="nx">@processPlugin</span> <span class="s2">&quot;stackBlur&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">radius</span><span class="p">]</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 