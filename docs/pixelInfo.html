<!DOCTYPE html>  <html> <head>   <title>pixelInfo.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="events.html">                 events.js               </a>                                           <a class="source" href="filters.html">                 filters.js               </a>                                           <a class="source" href="header.html">                 header.js               </a>                                           <a class="source" href="io.html">                 io.js               </a>                                           <a class="source" href="layers.html">                 layers.js               </a>                                           <a class="source" href="loader.html">                 loader.js               </a>                                           <a class="source" href="pixelInfo.html">                 pixelInfo.js               </a>                                           <a class="source" href="render.html">                 render.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               pixelInfo.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The pixelInfo object. This object is available inside of the
process() loop, and it lets filter developers have simple access
to any arbitrary pixel in the image, as well as information about
the current pixel in the loop.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global Caman: true */</span> 
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Caman</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Allows the currently rendering filter to get data about
surrounding pixels relative to the pixel currently being
processed. The data returned is identical in format to the
rgba object provided in the process function.</p>

<p>Example: to get data about the pixel to the top-right
of the currently processing pixel, you can call (within the process
function):</p>

<pre>this.getPixelRelative(1, -1);</pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixelInfo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">self</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span> <span class="o">=</span> <span class="nx">self</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Retrieves the X, Y location of the current pixel. The origin is at the bottom left
corner of the image, like a normal coordinate system.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixelInfo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">locationXY</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This was a serious pain in the ass to get right. Since the pixel array is a simple
1-dimensional array (and for good reason) we have to do some math-y magic to calculate
our current X, Y position.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loc</span> <span class="o">/</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">));</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">loc</span> <span class="o">%</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="o">/</span> <span class="mi">4</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span><span class="p">};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Returns an RGBA object for a pixel whose location is specified in relation to the current pixel.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixelInfo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPixelRelative</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">horiz_offset</span><span class="p">,</span> <span class="nx">vert_offset</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>We invert the vert_offset in order to make the coordinate system non-inverted. In laymans
terms: -1 means down and +1 means up.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">newLoc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loc</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="nx">vert_offset</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="nx">horiz_offset</span><span class="p">);</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Error handling</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">newLoc</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">newLoc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">r</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">g</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">0</span><span class="p">};</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">r</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="p">],</span>
    <span class="nx">g</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">b</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
    <span class="nx">a</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
  <span class="p">};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The counterpart to getPixelRelative, this updates the value of a pixel whose location is specified in
relation to the current pixel.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixelInfo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">putPixelRelative</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">horiz_offset</span><span class="p">,</span> <span class="nx">vert_offset</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">newLoc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loc</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="nx">vert_offset</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="nx">horiz_offset</span><span class="p">);</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Error handling</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">newLoc</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">newLoc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="p">]</span>   <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Gets an RGBA object for an arbitrary pixel in the canvas specified by absolute X, Y coordinates</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixelInfo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPixel</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">newLoc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">r</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="p">],</span>
    <span class="nx">g</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">b</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
    <span class="nx">a</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
  <span class="p">};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Updates the pixel at the given X, Y coordinates  </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Caman</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixelInfo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">putPixel</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">rgba</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">newLoc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="p">]</span>   <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">g</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">manip</span><span class="p">.</span><span class="nx">pixel_data</span><span class="p">[</span><span class="nx">newLoc</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgba</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}(</span><span class="nx">Caman</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 